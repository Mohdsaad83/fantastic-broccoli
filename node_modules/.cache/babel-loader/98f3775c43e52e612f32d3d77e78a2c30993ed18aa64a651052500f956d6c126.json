{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from\"react\";import api from\"../services/api\";import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export function AuthProvider(_ref){let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);// Check if user is authenticated on app load\nuseEffect(()=>{const initializeAuth=async()=>{const token=localStorage.getItem(\"token\");if(token){try{// Verify token with backend\nconst response=await api.get(\"/auth/me\");setUser(response.data.user);}catch(error){console.log(\"Token verification failed:\",error.message);// Token is invalid, remove it\nlocalStorage.removeItem(\"token\");localStorage.removeItem(\"user\");}}setLoading(false);};initializeAuth();},[]);// Login function\nconst login=async(email,password)=>{setLoading(true);try{const response=await api.post(\"/auth/login\",{email,password});const{token,user:userData}=response.data;// Store token and user data\nlocalStorage.setItem(\"token\",token);localStorage.setItem(\"user\",JSON.stringify(userData));setUser(userData);setLoading(false);return{success:true};}catch(error){var _error$response,_error$response$data;setLoading(false);const errorMessage=((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)||\"Login failed\";return{success:false,error:errorMessage};}};// Register function\nconst register=async userData=>{setLoading(true);try{const response=await api.post(\"/auth/register\",userData);const{token,user:newUser}=response.data;// Store token and user data\nlocalStorage.setItem(\"token\",token);localStorage.setItem(\"user\",JSON.stringify(newUser));setUser(newUser);setLoading(false);return{success:true};}catch(error){var _error$response2,_error$response2$data;setLoading(false);const errorMessage=((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.error)||\"Registration failed\";return{success:false,error:errorMessage};}};// Logout function\nconst logout=()=>{localStorage.removeItem(\"token\");localStorage.removeItem(\"user\");setUser(null);// Redirect to home page\nwindow.location.href=\"/\";};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,loading,login,register,logout},children:children});}export function useAuth(){return useContext(AuthContext);}","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","api","jsx","_jsx","AuthContext","AuthProvider","_ref","children","user","setUser","loading","setLoading","initializeAuth","token","localStorage","getItem","response","get","data","error","console","log","message","removeItem","login","email","password","post","userData","setItem","JSON","stringify","success","_error$response","_error$response$data","errorMessage","register","newUser","_error$response2","_error$response2$data","logout","window","location","href","Provider","value","useAuth"],"sources":["/Users/bosaad77/ga/porjects/fantastic-broccoli/src/contexts/Auth.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from \"react\"\nimport api from \"../services/api\"\n\nconst AuthContext = createContext()\n\nexport function AuthProvider({ children }) {\n  const [user, setUser] = useState(null)\n  const [loading, setLoading] = useState(true)\n\n  // Check if user is authenticated on app load\n  useEffect(() => {\n    const initializeAuth = async () => {\n      const token = localStorage.getItem(\"token\")\n      if (token) {\n        try {\n          // Verify token with backend\n          const response = await api.get(\"/auth/me\")\n          setUser(response.data.user)\n        } catch (error) {\n          console.log(\"Token verification failed:\", error.message)\n          // Token is invalid, remove it\n          localStorage.removeItem(\"token\")\n          localStorage.removeItem(\"user\")\n        }\n      }\n      setLoading(false)\n    }\n\n    initializeAuth()\n  }, [])\n\n  // Login function\n  const login = async (email, password) => {\n    setLoading(true)\n    try {\n      const response = await api.post(\"/auth/login\", { email, password })\n      const { token, user: userData } = response.data\n\n      // Store token and user data\n      localStorage.setItem(\"token\", token)\n      localStorage.setItem(\"user\", JSON.stringify(userData))\n      setUser(userData)\n\n      setLoading(false)\n      return { success: true }\n    } catch (error) {\n      setLoading(false)\n      const errorMessage = error.response?.data?.error || \"Login failed\"\n      return { success: false, error: errorMessage }\n    }\n  }\n\n  // Register function\n  const register = async (userData) => {\n    setLoading(true)\n    try {\n      const response = await api.post(\"/auth/register\", userData)\n      const { token, user: newUser } = response.data\n\n      // Store token and user data\n      localStorage.setItem(\"token\", token)\n      localStorage.setItem(\"user\", JSON.stringify(newUser))\n      setUser(newUser)\n\n      setLoading(false)\n      return { success: true }\n    } catch (error) {\n      setLoading(false)\n      const errorMessage = error.response?.data?.error || \"Registration failed\"\n      return { success: false, error: errorMessage }\n    }\n  }\n\n  // Logout function\n  const logout = () => {\n    localStorage.removeItem(\"token\")\n    localStorage.removeItem(\"user\")\n    setUser(null)\n    // Redirect to home page\n    window.location.href = \"/\"\n  }\n\n  return (\n    <AuthContext.Provider value={{ user, loading, login, register, logout }}>\n      {children}\n    </AuthContext.Provider>\n  )\n}\n\nexport function useAuth() {\n  return useContext(AuthContext)\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}